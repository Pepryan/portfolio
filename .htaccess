# Block all routes except home page
RewriteEngine On

# Redirect all requests to index.html except for favicon and static assets
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/favicon\.ico$
RewriteCond %{REQUEST_URI} !^/index\.html$
RewriteCond %{REQUEST_URI} !^/$
RewriteRule ^(.*)$ /index.html [L,R=301]

# Block access to specific directories and files
RedirectMatch 301 ^/app/(.*)$ /
RedirectMatch 301 ^/pages/(.*)$ /
RedirectMatch 301 ^/blog/(.*)$ /
RedirectMatch 301 ^/_next/(.*)$ /
RedirectMatch 301 ^/out/(.*)$ /
RedirectMatch 301 ^/src/(.*)$ /
RedirectMatch 301 ^/lib/(.*)$ /
RedirectMatch 301 ^/content/(.*)$ /
RedirectMatch 301 ^/scripts/(.*)$ /
RedirectMatch 301 ^/docs/(.*)$ /

# Block access to config files
<Files "package.json">
    Order allow,deny
    Deny from all
</Files>

<Files "next.config.mjs">
    Order allow,deny
    Deny from all
</Files>

<Files "tailwind.config.js">
    Order allow,deny
    Deny from all
</Files>

<Files "jsconfig.json">
    Order allow,deny
    Deny from all
</Files>

# Block access to node_modules
<DirectoryMatch "node_modules">
    Order allow,deny
    Deny from all
</DirectoryMatch>

# Set proper MIME types
AddType text/html .html
AddType image/x-icon .ico

# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Cache static files
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/ico "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>
